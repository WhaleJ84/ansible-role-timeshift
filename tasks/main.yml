---
- name: INSTALL | Timeshift
  block:
    - name: INSTALL | Install Timeshift from apt repository
      become: true
      ansible.builtin.apt:
        name: timeshift
        state: latest
      when: ansible_facts['pkg_mgr'] == "apt"
  tags: install

- name: CONFIGURE | Timeshift
  block:
    - name: CONFIGURE | Load content from /etc/timeshift.json
      ansible.builtin.include_vars:
        file: /etc/timeshift.json
        name: timeshift_config

    - name: CONFIGURE | Do First Run
      ansible.builtin.set_fact:
        timeshift_config: "{{ timeshift_config | default([]) | combine({ 'do_first_run': '{{ do_first_run }}' }) }}"
      when: timeshift_config['do_first_run'] != do_first_run
  tags: configure

- name: REMOVE | Timeshift
  block:
    - name: REMOVE | Remove timeshift from apt repository
      become: true
      ansible.builtin.apt:
        name: timeshift
        state: absent
      when: ansible_facts['pkg_mgr'] == "apt"
  tags: [remove, never]

